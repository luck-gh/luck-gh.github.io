{"title":"Uboot的MAKEFILE","slug":"UBOOT/UBOOT的Makefile","date":"2018-05-28T00:05:15.000Z","updated":"2018-10-21T08:33:49.735Z","comments":true,"path":"api/articles/UBOOT/UBOOT的Makefile.json","photos":[],"link":"","excerpt":"UBOOT是开机启动的第二阶段，用于更新或引导。","covers":null,"content":"<p>UBOOT是开机启动的第二阶段，用于更新或引导。</p>\n<a id=\"more\"></a>\n<h1 id=\"U-Boot-配置过程\"><a href=\"#U-Boot-配置过程\" class=\"headerlink\" title=\"U-Boot 配置过程\"></a>U-Boot 配置过程</h1><h2 id=\"一、定义主机系统架构\"><a href=\"#一、定义主机系统架构\" class=\"headerlink\" title=\"一、定义主机系统架构\"></a>一、定义主机系统架构</h2><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HOSTARCH := <span class=\"variable\">$(<span class=\"built_in\">shell</span> uname -m | \\</span></span><br><span class=\"line\"><span class=\"variable\">       sed -e s/i.86/i386/ \\</span></span><br><span class=\"line\"><span class=\"variable\">           -e s/sun4u/sparc64/ \\</span></span><br><span class=\"line\"><span class=\"variable\">           -e s/arm.*/arm/ \\</span></span><br><span class=\"line\"><span class=\"variable\">           -e s/sa110/arm/ \\</span></span><br><span class=\"line\"><span class=\"variable\">           -e s/powerpc/ppc/ \\</span></span><br><span class=\"line\"><span class=\"variable\">           -e s/ppc64/ppc/ \\</span></span><br><span class=\"line\"><span class=\"variable\">           -e s/macppc/ppc/)</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><code>sed –e</code>表示后面跟的是一串命令脚本，而表达式<code>s/abc/def/</code>表示要从标准输入中，查找到内容为<code>abc</code>的，然后替换成<code>def</code>。其中<code>abc</code>表达式用可以使用<code>.</code>作为通配符。</p>\n<p>命令<code>uname –m</code>将输出主机<code>CPU</code>的体系架构类型。作者的电脑使用<code>Intel Core2</code>系列的<code>CPU</code>，因此<code>uname –m</code>输出<code>i686</code>。<code>i686</code>可以匹配命令<code>sed -e s/i.86/i386/</code>中的<code>i.86</code>，因此在作者的机器上执行<code>Makefile</code>，<code>HOSTARCH</code>将被设置成<code>i386</code> 。</p>\n</blockquote>\n<h2 id=\"二、定义主机操作系统类型\"><a href=\"#二、定义主机操作系统类型\" class=\"headerlink\" title=\"二、定义主机操作系统类型\"></a>二、定义主机操作系统类型</h2><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HOSTOS := <span class=\"variable\">$(<span class=\"built_in\">shell</span> uname -s | tr '[:upper:]' '[:lower:]' | \\</span></span><br><span class=\"line\"><span class=\"variable\">           sed -e 's/cygwincygwin.*/cygwin/')</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><code>uname –s</code>输出主机内核名字，作者使用<code>Linux</code>发行版<code>Ubuntu9.10</code>，因此<code>uname –s</code>结果是<code>Linux</code>。</p>\n<p><code>tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;</code>作用是将标准输入中的所有大写字母转换为响应的小写字母。因此执行结果是将<code>HOSTOS</code> 设置为<code>linux</code>。</p>\n</blockquote>\n<h2 id=\"三、定义执行shell脚本的shell\"><a href=\"#三、定义执行shell脚本的shell\" class=\"headerlink\" title=\"三、定义执行shell脚本的shell\"></a>三、定义执行shell脚本的shell</h2><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Set shell to bash if possible, otherwise fall back to sh</span></span><br><span class=\"line\">SHELL := <span class=\"variable\">$(<span class=\"built_in\">shell</span> <span class=\"built_in\">if</span> [ -x \"$$BASH\" ]; then echo $$BASH; \\</span></span><br><span class=\"line\"><span class=\"variable\">\telse <span class=\"built_in\">if</span> [ -x /bin/bash ]; then echo /bin/bash; \\</span></span><br><span class=\"line\"><span class=\"variable\">\telse echo sh; fi; fi)</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><code>&quot;$$BASH&quot;</code>的作用实质上是生成了字符串<code>“$BASH”</code>（前一个<code>$</code>号的作用是指明第二个<code>$</code>是普通的字符）。若执行当前<code>Makefile</code>的<code>shell</code>中定义了<code>“$BASH”</code>环境变量，且文件<code>“$BASH”</code>是可执行文件，则<code>SHELL</code>的值为<code>“$BASH”</code>。否则，若<code>“/bin/bash”</code>是可执行文件，则<code>SHELL</code>值为<code>“/bin/bash”</code>。若以上两条都不成立，则将<code>“sh”</code>赋值给<code>SHELL</code>变量。由于作者的机器安装了<code>bash shell</code>，且<code>shell</code>默认环境变量中定义了<code>“$BASH”</code>，因此<code>SHELL</code> 被设置为<code>$BASH</code> 。</p>\n</blockquote>\n","categories":[{"name":"BOOT","slug":"BOOT","count":3,"path":"api/categories/BOOT.json"}],"tags":[{"name":"BOOT","slug":"BOOT","count":3,"path":"api/tags/BOOT.json"}]}